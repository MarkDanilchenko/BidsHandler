// --------------------------------------OPENAPI_CONFIG
const path = require('path');
const swaggerAutogen = require('swagger-autogen')({ openapi: '3.0.0' });
const dotenv = require('dotenv');
dotenv.config({ path: '../../../.env' });
// const swaggerConverter = require('swagger2openapi');

// --------------------------------------FILES AND ENDPOINTS DESTINATIONS
const outputFile = path.join(__dirname, 'swagger-output.json');
const endpointsFiles = [path.join(__dirname, '../../routes/router.js'), path.join(__dirname, '../../server.js')];

// --------------------------------------GENERATE DOCUMENTATION
const documentation = {
	info: {
		version: '1.0.0',
		title: 'RequestHandler API Documentation (OpenAPIv3)',
		description: 'Documentation automatically generated by the <b>swagger-autogen</b> module.',
	},
	servers: [
		{
			url: `http://${process.env.SERVER_HOST ?? '127.0.0.1'}:3000/api/v1`,
			description: 'API server',
		},
	],
	tags: [
		{
			name: 'Reg&Auth',
			description: 'Registration & authentication end-points',
		},
		{
			name: "Users' requests",
			description: "Users' requests end-points",
		},
		{
			name: 'Greeting',
			description: "API's greeting html-page end-point",
		},
	],
	components: {
		securitySchemes: {
			bearerAuth_schema: {
				type: 'http',
				scheme: 'bearer',
				// bearerFormat: 'JWT',
			},
		},
		schemas: {
			ServerError_schema: {
				$message: 'Internal server error',
			},
		},
		examples: {
			ServerError_example: {
				value: {
					message: 'Internal server error',
				},
				summary: 'The response message of the server error',
			},
		},
	},
};
swaggerAutogen(outputFile, endpointsFiles, documentation).then((result) => {
	console.log(`Swagger generation complete: ${result.success}`);
	// swaggerConverter.convertFile(outputFile, {}, function (err, result) {
	// 	if (err) {
	// 		console.log(err);
	// 	} else {
	// 		fs.writeFile(path.join(__dirname, 'swagger-output-3.json'), JSON.stringify(result.openapi), function (err) {
	// 			if (err) {
	// 				console.log(err);
	// 			}
	// 		});
	// 	}
	// });
});
